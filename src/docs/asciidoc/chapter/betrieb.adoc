== Betrieb

=== Architektur
Die Architektur des ÖREB-Katasters wird im «Infrastruktur- und Betriebskonzept» (Version 1.0 vom 28. Januar 2019) vertieft erläutert.

[#oereb-architektur] 
.Architektur ÖREB-Kataster 
image::oereb-system-architektur-v03-Page-1.png[oereb-architektur]   

Bestehende GDI-Komponenten sind blau, ÖREB-Komponenten lachsfarben. Der Web GIS Client und die Datenablage müssten korrekterweise beide Farben aufweisen.

Vorhandene kantonale Daten werden in der Edit-DB in einem dafür vorgesehenen Schema in eine dem Rahmenmodell (Teilmodell Transferstruktur) äquivalente Struktur gebracht und anschliessend exportiert und in die ÖREB-DB importiert werden. Daten aus Fachanwendungen (Kataster der belasteten Standorten) und Bundesdaten müssen nur in die ÖREB-DB importiert werden, da sie bereits im Rahmenmodell bereitgestellt werden. Ein Datenumbau entfällt. Sämtliche Daten (inkl. amtliche Vermessung, Annexdaten, ...) werden in das gleiche Schema importiert. Es werden zwei identische Schemen erstellt: _live_ und _stage_. Das _stage_-Schema dient der Validierung der Daten. Ist diese erfolgreich, werden die Daten in das _live_-Schema importiert.

=== Komponenten
Der ÖREB-Kataster des Kantons Solothurn besteht aus den folgenden, originären Komponenten:

- ÖREB-Datenbank
- ÖREB-WMS
- ÖREB Web Service
- ÖREB-Iconizer (integriert in GRETL) 
- ÖREB GRETL-Jobs
- ÖREB-Annexmodell
- ÖREB Web GIS Client (Bestandteil des Web GIS Clients)
- Dokumentenablage (bereits bestehende Komponente für die digitale Nutzungsplanung)
- ÖREB-Handbuch (vorliegendes Handbuch)

Nicht speziell aufgelistet sind die verschiedenen Arbeits-Datenbank-Schemen in der Edit-DB, die zur Herstellung der Daten im INTERLIS-Rahmenmodell benötigt werden. Dazu wird im Kapitel XXXXXX ("Benutzerhandbuch") näher eingegangen. https://gretl.so.ch/[_GRETL-Jenkins_], das zur Steuerung der GRETL-Jobs verwendet wird, wird ebenfalls nicht in diesem Handbuch detailliert behandelt und beschrieben, da es sich um eine Standardkomponenten der GDI handelt.

==== ÖREB-Datenbank
https://github.com/sogis/oereb-db[https://github.com/sogis/oereb-db]

In der ÖREB-Datenbank werden in zwei Schemen (_live_ und _stage_) sämtliche für den Betrieb des ÖREB-Katasters notwendigen Daten gespeichert. Dazu gehören die eigentlichen ÖREB-Daten (inkl. kantonaler Gesetze und Verordnungen und Bundesgesetze und -verordnungen) sowie die amtliche Vermessung (im Bundesmodell), die PLZ- und Ortschaftsperimeter und die Annexdaten.

Die Datenstruktur entspricht einem mit _ili2pg_ angelegten Schema und Tabellen und sind entsprechend normalisiert. Für die Bereitstellung via WMS werden zusätzlich denormalisierte, «flachgewalzte» Tabellen eingesetzt. Die Dokumente pro Geometrieobjekt werden als JSON-Array gespeichert. 

Das _stage_-Schema dient der Validierung der Daten.

Die Kernfunktionalität des Respositories ist das (aus den Datenmodellen) automatische Herstellen der DDL-Queries zum Aufsetzen der Datenbank. Dieser Prozess wird mit einem Bash-Skript durchgeführt. Ein weiteres Resultat des Prozesses ist ein Docker-Image, das aber nicht für den produktiven Betrieb in der GDI verwendet wird, sondern für Test- und Entwicklungszwecken eingesetzt werden kann. In der Produktion werden die DDL-Queries mit _Ansible_ auf dem bereits vorhandenen Datenbankserver und -cluster deployed.

==== ÖREB-WMS
https://github.com/sogis/oereb-wms[https://github.com/sogis/oereb-wms]



dient auch dem iconizer


==== Komponentendiagramm

=== Entwicklung
foo


=== Technisches Staging
test, int, prod